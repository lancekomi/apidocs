# Data Models API

## Overview

This document describes all data structures, classes, and enumerations used by the Base VPN Library.

**Namespace**: `SmartDNSProxy_VPN_Client`

---

## ServerInformation

Represents information about a VPN server.

### Class Declaration

```csharp
class ServerInformation
```

### Properties

```csharp
public string DnsAddress;      // Server hostname/DNS address
public string country;         // Country name
public string city;            // City name
public string[] protocols;     // Supported protocols
public string name;            // Display name
public string note;            // Additional notes
public string torrentP2P;      // "Yes" or "No"
public string smartVPN;        // "Yes" or "No"
public string[] ip;            // DNS server IP addresses
```

### Property Details

| Property | Type | Description | Example |
|----------|------|-------------|---------|
| `DnsAddress` | string | Server hostname or IP | `"us-ny.vpn.example.com"` |
| `country` | string | Country location | `"United States"` |
| `city` | string | City location | `"New York"` |
| `protocols` | string[] | Supported VPN protocols | `["PPTP", "L2TP", "OpenVPN"]` |
| `name` | string | Display name for UI | `"New York - Torrent"` |
| `note` | string | Additional information | `"Fast server"` |
| `torrentP2P` | string | Torrent/P2P allowed | `"Yes"` or `"No"` |
| `smartVPN` | string | SmartVPN enabled | `"Yes"` or `"No"` |
| `ip` | string[] | DNS server IPs | `["8.8.8.8", "8.8.4.4"]` |

### Methods

#### ToString

```csharp
public override string ToString()
```

Returns the server's display name (same as `name` property).

#### ServerName (Property)

```csharp
public string ServerName { get; }
```

Readonly property that returns `name`.

### Usage Example

```csharp
var server = new ServerInformation
{
    DnsAddress = "us-ny.vpn.example.com",
    country = "United States",
    city = "New York",
    protocols = new[] { "PPTP", "L2TP", "SSTP", "OpenVPN" },
    name = "New York - Torrent",
    note = "High-speed server",
    torrentP2P = "Yes",
    smartVPN = "No",
    ip = new[] { "8.8.8.8", "8.8.4.4" }
};

// Display in UI
serverListBox.Items.Add(server); // Uses ToString()
Console.WriteLine(server.ServerName); // "New York - Torrent"
```

### Name Generation

The `name` property is automatically generated by `ServerListClient` based on attributes:

```
If city is valid:
  If torrentP2P="Yes" AND smartVPN="Yes":
    name = "{city} - SmartVPN / Torrent"
  Else If torrentP2P="Yes":
    name = "{city} - Torrent"
  Else If smartVPN="Yes":
    name = "{city} - SmartVPN"
  Else:
    name = "{city}"
Else:
  name = DnsAddress
```

**Examples:**
- `"London - SmartVPN / Torrent"` (both features)
- `"Tokyo - Torrent"` (torrent only)
- `"Paris - SmartVPN"` (SmartVPN only)
- `"Berlin"` (standard server)

---

## OpenVPNConnectionInfo

Connection parameters for OpenVPN.

### Class Declaration

```csharp
class OpenVPNConnectionInfo
```

### Properties

```csharp
public string host;       // Server hostname or IP
public string username;   // VPN username
public string password;   // VPN password
public string protocol;   // "tcp" or "udp"
public int port;          // Port number
```

### Property Details

| Property | Type | Description | Typical Values |
|----------|------|-------------|----------------|
| `host` | string | Server address | `"vpn.example.com"` or `"1.2.3.4"` |
| `username` | string | Authentication username | User's username |
| `password` | string | Authentication password | User's password |
| `protocol` | string | Transport protocol | `"tcp"` or `"udp"` |
| `port` | int | Connection port | `443`, `1194`, `8080` |

### Usage Example

```csharp
var connectionInfo = new OpenVPNConnectionInfo
{
    host = "us-ny.vpn.example.com",
    username = "myusername",
    password = "mypassword",
    protocol = "tcp",  // or "udp"
    port = 443
};

openVPN.connect(connectionInfo, OnConnected);
```

### Protocol Selection

**TCP:**
- More reliable (retransmissions)
- Works through most firewalls
- Slightly slower
- Recommended for: Restrictive networks, reliability

**UDP:**
- Faster performance
- Lower latency
- Better for streaming/gaming
- May be blocked by firewalls
- Recommended for: Performance, gaming, streaming

### Common Ports

| Port | Protocol | Notes |
|------|----------|-------|
| 443 | TCP | HTTPS port, rarely blocked |
| 1194 | UDP | Default OpenVPN port |
| 1194 | TCP | Alternative |
| 8080 | TCP | HTTP proxy port |
| 53 | UDP | DNS port (rarely blocked) |

---

## StandardVpnProtocol

Enumeration of standard Windows VPN protocols.

### Enum Declaration

```csharp
public enum StandardVpnProtocol
{
    PPTP,
    L2TP,
    SSTP
}
```

### Values

| Value | Description | Port/Protocol |
|-------|-------------|---------------|
| `PPTP` | Point-to-Point Tunneling Protocol | TCP 1723 + GRE |
| `L2TP` | Layer 2 Tunneling Protocol | UDP 500, 4500 (IPsec) |
| `SSTP` | Secure Socket Tunneling Protocol | TCP 443 (HTTPS) |

### Usage Example

```csharp
// Parse from string
Enum.TryParse("L2TP", out StandardVpnProtocol protocol);

// Use in connection
ras.Connect(
    entryName: "MyVPN",
    host: "vpn.example.com",
    username: "user",
    password: "pass",
    returnDialerState: OnStateChanged,
    vpnProtocol: protocol,
    preSharedKey: protocol == StandardVpnProtocol.L2TP ? "psk" : null
);
```

### Protocol Comparison

| Feature | PPTP | L2TP | SSTP |
|---------|------|------|------|
| Speed | Fast | Medium | Medium |
| Security | Weak | Strong | Strong |
| Compatibility | Excellent | Good | Windows only |
| Firewall-friendly | Poor | Poor | Excellent |
| Setup complexity | Easy | Medium | Easy |

**Recommendations:**
- **PPTP**: Legacy, avoid if possible (weak encryption)
- **L2TP**: Good balance, requires pre-shared key
- **SSTP**: Best for restrictive networks (uses HTTPS port)

---

## AuthApiResponse

Authentication result enumeration.

### Enum Declaration

```csharp
public enum AuthApiResponse
{
    Success,
    InvalidCredentials,
    AccountDisabled,
    ServerError
}
```

### Values

| Value | HTTP Code | Description |
|-------|-----------|-------------|
| `Success` | 200 | Authentication successful |
| `InvalidCredentials` | 404, 405 | Wrong username or password |
| `AccountDisabled` | 401 | Account exists but is disabled |
| `ServerError` | 5xx, Exception | Server error or network issue |

### Usage Example

```csharp
var result = await AuthApi.Authorize(username, password);

switch (result)
{
    case AuthApiResponse.Success:
        // Proceed with connection
        ConnectToVPN();
        break;
        
    case AuthApiResponse.InvalidCredentials:
        MessageBox.Show("Invalid username or password");
        passwordBox.Clear();
        passwordBox.Focus();
        break;
        
    case AuthApiResponse.AccountDisabled:
        MessageBox.Show("Your account has been disabled. Please contact support.");
        break;
        
    case AuthApiResponse.ServerError:
        MessageBox.Show("Cannot reach authentication server. Please try again later.");
        break;
}
```

---

## OpenVPN.Config

Internal configuration class for OpenVPN (currently unused).

### Class Declaration

```csharp
public class Config
{
    public string name { get; set; }
    public string[] parameters { get; set; }
}
```

**Note:** This class is defined but not actively used in current implementation.

---

## RasDialer States

Connection states from DotRas library (RasConnectionState enum).

### Common States

| State | Description |
|-------|-------------|
| `OpenPort` | Opening the communication port |
| `PortOpened` | Port has been opened |
| `ConnectDevice` | Connecting the device |
| `DeviceConnected` | Device successfully connected |
| `AllDevicesConnected` | All devices connected |
| `Authenticate` | Authenticating username and password |
| `AuthNotify` | Authentication notification |
| `AuthRetry` | Retrying authentication |
| `AuthCallback` | Authentication callback |
| `AuthChangePassword` | Password change required |
| `AuthProject` | Projecting authentication |
| `AuthLinkSpeed` | Determining link speed |
| `AuthAck` | Authentication acknowledged |
| `ReAuthenticate` | Re-authenticating |
| `Authenticated` | Authentication successful |
| `PrepareForCallback` | Preparing for callback |
| `WaitForModemReset` | Waiting for modem reset |
| `WaitForCallback` | Waiting for callback |
| `Projected` | Network protocols projected |
| `StartAuthentication` | Starting authentication |
| `CallbackComplete` | Callback complete |
| `LogonNetwork` | Logging on to network |
| `SubEntryConnected` | Sub-entry connected |
| `SubEntryDisconnected` | Sub-entry disconnected |
| `Interactive` | Interactive mode |
| `RetryAuthentication` | Retrying authentication |
| `CallbackSetByCaller` | Callback set by caller |
| `PasswordExpired` | Password has expired |
| `InvokeEapUi` | Invoke EAP UI |
| `Connected` | Successfully connected |
| `Disconnected` | Connection terminated |

### Handling States

```csharp
private void OnDialerStateChanged(string state)
{
    Console.WriteLine($"Connection state: {state}");
    
    if (state == "Connected")
    {
        // Connection established
        EnableDisconnectButton();
    }
    else if (state == "Authenticated")
    {
        // Authentication successful, nearly done
        ShowProgress(90);
    }
    else if (state.Contains("Error"))
    {
        // Error occurred
        HandleConnectionError(state);
    }
}
```

---

## Type Conversion Examples

### String to StandardVpnProtocol

```csharp
string protocolStr = "L2TP";
StandardVpnProtocol protocol;

if (Enum.TryParse(protocolStr, out protocol))
{
    Console.WriteLine($"Protocol: {protocol}");
}
else
{
    Console.WriteLine("Invalid protocol");
}
```

### ServerInformation from CSV

```csharp
// ServerListClient automatically creates ServerInformation from CSV
var client = new ServerListClient();
ServerInformation[] servers = client.GetServerList();

// Filter servers
var torrentServers = servers.Where(s => s.torrentP2P == "Yes").ToArray();
var smartVPNServers = servers.Where(s => s.smartVPN == "Yes").ToArray();
var openVPNServers = servers.Where(s => s.protocols.Contains("OpenVPN")).ToArray();
```

---

## Validation Examples

### Validate ServerInformation

```csharp
bool IsValidServer(ServerInformation server)
{
    if (server == null) return false;
    if (string.IsNullOrWhiteSpace(server.DnsAddress)) return false;
    if (server.protocols == null || server.protocols.Length == 0) return false;
    return true;
}
```

### Validate OpenVPNConnectionInfo

```csharp
bool IsValidConnectionInfo(OpenVPNConnectionInfo info)
{
    if (info == null) return false;
    if (string.IsNullOrWhiteSpace(info.host)) return false;
    if (string.IsNullOrWhiteSpace(info.username)) return false;
    if (string.IsNullOrWhiteSpace(info.password)) return false;
    if (info.protocol != "tcp" && info.protocol != "udp") return false;
    if (info.port < 1 || info.port > 65535) return false;
    return true;
}
```

---

## Serialization Examples

### Save ServerInformation to JSON

```csharp
using Newtonsoft.Json;

// Serialize
string json = JsonConvert.SerializeObject(server, Formatting.Indented);
File.WriteAllText("server.json", json);

// Deserialize
string json = File.ReadAllText("server.json");
var server = JsonConvert.DeserializeObject<ServerInformation>(json);
```

### Save Connection Settings

```csharp
// Save to app settings
Properties.Settings.Default.LastServer = server.DnsAddress;
Properties.Settings.Default.LastProtocol = "OpenVPN";
Properties.Settings.Default.LastPort = 443;
Properties.Settings.Default.Save();

// Load from settings
string serverAddress = Properties.Settings.Default.LastServer;
string protocol = Properties.Settings.Default.LastProtocol;
int port = Properties.Settings.Default.LastPort;
```

---

## Best Practices

### 1. Server Selection

```csharp
// Find fastest server for user's location
ServerInformation SelectBestServer(ServerInformation[] servers, string userCountry)
{
    // Prefer same country
    var localServers = servers.Where(s => s.country == userCountry).ToArray();
    if (localServers.Any())
        return localServers.First();
    
    // Fallback to any server
    return servers.First();
}
```

### 2. Protocol Selection

```csharp
string SelectBestProtocol(ServerInformation server)
{
    // Prefer OpenVPN for security
    if (server.protocols.Contains("OpenVPN"))
        return "OpenVPN";
    
    // Fallback to SSTP (firewall-friendly)
    if (server.protocols.Contains("SSTP"))
        return "SSTP";
    
    // Last resort
    if (server.protocols.Any())
        return server.protocols[0];
    
    throw new Exception("No supported protocols");
}
```

### 3. Error Handling

```csharp
try
{
    var connectionInfo = new OpenVPNConnectionInfo
    {
        host = server.DnsAddress,
        username = username,
        password = password,
        protocol = "tcp",
        port = 443
    };
    
    if (!IsValidConnectionInfo(connectionInfo))
    {
        throw new ArgumentException("Invalid connection info");
    }
    
    openVPN.connect(connectionInfo, OnConnected);
}
catch (Exception ex)
{
    MessageBox.Show($"Connection failed: {ex.Message}");
}
```

---

## Related APIs

- [ServerListClient](ServerListClient.md) - Creates ServerInformation objects
- [OpenVPN](OpenVPN.md) - Uses OpenVPNConnectionInfo
- [Ras](Ras.md) - Uses StandardVpnProtocol
- [AuthApi](AuthApi.md) - Returns AuthApiResponse

## See Also

- [Getting Started Guide](GettingStarted.md)
- [Examples](Examples.md)

---

**API Version**: 1.0  
**Last Updated**: October 2025

